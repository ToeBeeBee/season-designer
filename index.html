<!DOCTYPE html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet">
</head>

<body>
    <section id="canvas-area">
        <!--<canvas></canvas>-->
    </section>

</body>
<!-- <script type="module" src="js/season.js?v=6"></script> -->
<script type="module">import*as THREE from"https://cdn.jsdelivr.net/npm/three@0.125.2/build/three.module.js";import{SVGLoader}from"https://cdn.jsdelivr.net/npm/three@0.125.2/examples/jsm/loaders/SVGLoader.js";const vshader="\nuniform float size;\nattribute float scale;\n\nvoid main() {\n\n\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n    gl_PointSize = (size + scale) * ( 300.0 / -mvPosition.z );\n\n    gl_Position = projectionMatrix * mvPosition;\n\n}\n",fshader="\nuniform vec3 color;\nuniform float opacity;\n\nvoid main() {\n\n    if ( length( gl_PointCoord - vec2( 0.5, 0.5 ) ) > 0.475 ) discard;\n\n    gl_FragColor = vec4( color, opacity );\n\n}\n";let logoSVGObject,logoMesh,originalLogoVertecies,scales,scene,camera,renderer,ctx,logoFile="./js/season.svg",loader=new SVGLoader,frameCount=0,particleLimit=8e3,paused=!1,pauseCount=0,pauseLength=100,randomVectors=[],canvasArea=document.getElementById("canvas-area"),playback=!0;const speed=450*5e-6,hDist=450,vDist=1500,twDist=1,dRandomSize=20,dsize=20;function initScene(){scene=new THREE.Scene,renderer=new THREE.WebGLRenderer({antialias:!0}),(camera=new THREE.PerspectiveCamera(30,canvasArea.clientWidth/canvasArea.clientHeight,.1,1e4)).position.z=-955,camera.lookAt(0,0,0),renderer.setSize(canvasArea.clientWidth,canvasArea.clientHeight),canvasArea.appendChild(renderer.domElement),loader.load(logoFile,addSVGtoScene,function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.log("An error happened")})}function addSVGtoScene(e){let t=e.paths;logoSVGObject=new THREE.Group;let a=new THREE.Vector3;for(let e=0;e<t.length;e++){let n=t[e],r=new THREE.MeshBasicMaterial({transparent:!0,color:16777215,side:THREE.DoubleSide,depthWrite:!1}),o=n.toShapes(!0);for(let e=0;e<o.length;e++){let t=o[e],n=new THREE.ShapeBufferGeometry(t),i=new THREE.Vector3;n.computeBoundingBox(),n.boundingBox.getCenter(i),a.x+=i.x,a.y+=i.y;let s=new THREE.Mesh(n,r);logoSVGObject.add(s)}a.x=a.x/o.length,a.y=a.y/o.length}let n=new THREE.Matrix4;canvasArea.clientHeight>canvasArea.clientWidth?n.makeScale(.5,.5,.5):n.makeScale(1,1,1),n.multiply((new THREE.Matrix4).makeRotationZ(Math.PI)),n.multiply((new THREE.Matrix4).makeTranslation(-a.x,-a.y,0)),logoSVGObject.applyMatrix4(n),scene.add(logoSVGObject),renderer.render(scene,camera);let r=new THREE.BufferGeometry,o=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(16777215)},size:{value:dsize},opacity:{value:1}},transparent:!0,vertexShader:vshader,fragmentShader:fshader});createLogoInParticles(),calculateMeshAttributes(),r.setAttribute("position",new THREE.BufferAttribute(originalLogoVertecies.slice(),3)),r.setAttribute("scale",new THREE.BufferAttribute(scales.slice(),1)),logoMesh=new THREE.Points(r,o),scene.add(logoMesh),animate()}function updateMesh(e){for(let t=0;t<e.geometry.attributes.position.array.length;t++)e.geometry.attributes.position.array[t]=originalLogoVertecies[t]+randomVectors[t]*animationPercentage(frameCount);for(let t=0;t<e.geometry.attributes.scale.array.length;t++)e.geometry.attributes.scale.array[t]=scales[t]*animationPercentage(frameCount);e.material.uniforms.size.value=dsize,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.scale.needsUpdate=!0,console.log(scales)}function canvasScaleFactor(){return Math.pow(canvasArea.clientWidth,2)+Math.pow(canvasArea.clientHeight,2)}function calculateMeshAttributes(){for(let e=0;e<originalLogoVertecies.length;e++){let t=1-(Math.pow(originalLogoVertecies[3*e],2)+Math.pow(originalLogoVertecies[3*e+1],2)+Math.pow(originalLogoVertecies[3*e+2],2))*twDist;randomVectors[3*e]=(hDist-Math.random()*hDist*2)*t,randomVectors[3*e+1]=(vDist-Math.random()*vDist*2)*t,randomVectors[3*e+2]=-200-950*Math.random()}for(let e=0;e<scales.length;e++)scales[e]=Math.random()*dRandomSize}function createLogoInParticles(){let e=[],t=renderer.getContext(),a=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);t.readPixels(0,0,t.drawingBufferWidth,t.drawingBufferHeight,t.RGBA,t.UNSIGNED_BYTE,a);let n=2*Math.tan(camera.fov*Math.PI/180/2)*Math.abs(camera.position.z)/t.drawingBufferHeight;for(let r=0;r<a.length/4;r++){(a[4*r]+a[4*r+1]+a[4*r+2])/3>128&&r%Math.ceil(.001*a.length/particleLimit)==0&&(e.push(Math.random()-.5+(t.drawingBufferWidth/2-r%t.drawingBufferWidth)*n),e.push(Math.random()-.5+-1*(t.drawingBufferHeight/2-r/t.drawingBufferWidth)*n),e.push(0))}originalLogoVertecies=new Float32Array(e.length),scales=new Float32Array(e.length/3);for(let t=0;t<e.length;t++)scales[t%3]=0,originalLogoVertecies[t]=e[t];for(let e=0;e<scales.length;e++)scales[e%3]=0}function onWindowResize(){camera.aspect=canvasArea.clientWidth/canvasArea.clientHeight,camera.updateProjectionMatrix(),renderer.setSize(canvasArea.clientWidth,canvasArea.clientHeight)}function sigmoid(e,t){return 1/(1+Math.pow(Math.E,-(t+-1.78*t*e)))}function guassian(e,t){return 1/t*Math.sqrt(2*Math.PI)*Math.pow(Math.E,-Math.pow(e-b,2)/Math.pow(2*t,2))}function pingpong(e,t,a){let n=a-t;return(e%=2*n)<n?t+e:t+(n-(e-n))}function animationPercentage(e){return sigmoid(pingpong(e,0,1),-9)}function percentageBetweenValues(e,t,a){return(e-t)/(a-t)}function animate(){requestAnimationFrame(animate),playback&&(updateMesh(logoMesh),!paused&&animationPercentage(frameCount)<animationPercentage(speed)&&(paused=!0),paused&&pauseCount>=pauseLength&&(pauseCount=0,frameCount=speed,paused=!1),paused?pauseCount++:frameCount+=speed,logoMesh.material.uniforms.opacity.value=percentageBetweenValues(animationPercentage(frameCount),0,5e-4),logoSVGObject.children[0].material.opacity=1.1-percentageBetweenValues(animationPercentage(frameCount),0,5e-4),renderer.render(scene,camera))}window.onload=initScene,window.onresize=onWindowResize;</script>
</html>